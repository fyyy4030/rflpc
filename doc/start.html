<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>rfLPC: Getting started in 10 minutes</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">rfLPC
   
   </div>
   <div id="projectbrief">A low level library for using NXP&#39;s LPC17xx SoC. Config is given for MBED prototyping board</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('start.html','');
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting started in 10 minutes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#faq">Small FAQ</a><ul><li class="level2"><a href="#description">What is this library?</a></li>
<li class="level2"><a href="#needs">What is needed to use rfLPC?</a></li>
<li class="level2"><a href="#inside">What is provided?</a></li>
<li class="level2"><a href="#missing">What is missing?</a></li>
<li class="level2"><a href="#use">What is using this library ?</a></li>
</ul>
</li>
<li class="level1"><a href="#how">Environment configuration and building the library</a></li>
<li class="level1"><a href="#first-program">Your first program</a></li>
<li class="level1"><a href="#config">Fine tuning the library</a><ul><li class="level2"><a href="#config-file">Automatic generation of the configuration file</a></li>
<li class="level2"><a href="#fine-tune">Fine tuning the configuration file</a></li>
<li class="level2"><a href="#warnings">Common configuration mistakes</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="faq"></a>
Small FAQ</h2>
<h3><a class="anchor" id="description"></a>
What is this library?</h3>
<p>This library allows development on a LPC17xx board from NXP. The release includes configuration for the MBED platform which uses a LPC1768.</p>
<h3><a class="anchor" id="needs"></a>
What is needed to use rfLPC?</h3>
<p>In order to compile, you will need a gcc version tuned to build bare metal binaries. I use the one which can be build using the shell script available here: <a href="https://github.com/esden/summon-arm-toolchain">https://github.com/esden/summon-arm-toolchain</a></p>
<p>This release also includes two header files from ARM and NXP that defines C structures to access Cortex M3 and LPC17xx registers.</p>
<h3><a class="anchor" id="inside"></a>
What is provided?</h3>
<p>This library provides</p>
<ul>
<li>A linker script</li>
<li>Board initialization code (mainly, data and bss segment initialization, moving the interrupt vector in RAM and configuring the PLL0 to set the CPU clock to something usable (96Mhz for the MBED)</li>
<li>Few libc like functions (memcpy, printf)</li>
<li>Drivers for several peripherals<ul>
<li>Onboard LEDs</li>
<li>Ethernet 100Mbps</li>
<li>GPIO</li>
<li>Repetitive Interrupt Timer</li>
<li>System Tick Timer</li>
<li>General purpose Timers</li>
<li>UART </li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="missing"></a>
What is missing?</h3>
<p>A lot of stuff ! Mainly the remainder of drivers for the other devices such as</p>
<ul>
<li>CAN</li>
<li>DAC/ADC</li>
<li>PWM</li>
<li>... </li>
</ul>
<h3><a class="anchor" id="use"></a>
What is using this library ?</h3>
<p>This library has mainly been developped for two purposes</p>
<ul>
<li>Enjoying myself</li>
<li>Provide a nice prototyping platform for my research team (you can have a look at my research work here <a href="http://www.lifl.fr/~hauspie">http://www.lifl.fr/~hauspie</a>)</li>
</ul>
<p>For this last purpose, the MBED was a nice and affordable platform although the whole on the cloud compiler stuff was not much what pleases us as the libraries provided by mbed were HUGE and we wanted to release ALL our code open source, even the low level code. The library provided by NXP (CMSIS) was a bit too high level for what we wanted and thus, writing everything from scratch was our best option.</p>
<p>The first of our project which has been ported to the MBED is Smews: Smart &amp; Mobile Embedded Web Server (<a href="http://www.lifl.fr/2XS/smews">http://www.lifl.fr/2XS/smews</a>)</p>
<h2><a class="anchor" id="how"></a>
Environment configuration and building the library</h2>
<p>To use the library, you just have to compile it by issuing a <code>'make'</code> in the main folder. It will build the library as well as all the samples. But before that, you have to install an arm compiler and modify the Makefile.vars to set the path and executable names of your compiler. The library should be shipped with the configuration for arm-none-eabi-* tools suite. Modifying <code>PREFIX</code> and <code>GCC_VERSION</code> should be enough.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> ## Modify these settings</span>
<span class="preprocessor"></span> PREFIX=arm-none-eabi
 GCC_VERSION=

<span class="preprocessor"> ## System commands definitions</span>
<span class="preprocessor"></span> CC=$(PREFIX)-gcc$(GCC_VERSION)
 LD=$(CC)
 AR=$(PREFIX)-ar
 AS=$(PREFIX)-as
 OBJCOPY=$(PREFIX)-objcopy
 OBJDUMP=$(PREFIX)-objdump
 NM=$(PREFIX)-nm
 SIZE=$(PREFIX)-size
</pre></div><p>If everything builds, then you are ready to use it.</p>
<p>Otherwise, there are few things that you have to check:</p>
<ul>
<li>Do you have an arm compiler in your path?<ul>
<li>is the <code>Makefile.vars</code> file modified according to this compiler?</li>
</ul>
</li>
<li>Have you modified the config/config file which has been generated when compiling the library for the first time?<ul>
<li>if so, then the library may compile but some samples will not depending on what functionalities you have enabled</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="first-program"></a>
Your first program</h2>
<p>The easiest way to start your first program is to copy the samples/skel folder and start from here.</p>
<p>In this folder, you will find two files</p>
<ul>
<li>Makefile</li>
<li>main.c</li>
</ul>
<p>The Makefile rules how your program is compiled. Here is how it looks </p>
<div class="fragment"><pre class="fragment"> OUTPUT_NAME=modify_this
 SRC=$(wildcard *.c)
 OBJS=$(SRC:.c=.o)
 
<span class="preprocessor"> # Modify this variable at your own risk</span>
<span class="preprocessor"></span> RFLPC_DIR=../..
 include $(RFLPC_DIR)/Makefile.in
</pre></div><ul>
<li>the <code>OUTPUT_NAME</code> variable define the name of the final binary. Here it will generate <code>modify_this.elf</code> and <code>modify_this.bin</code> files </li>
<li>the <code>SRC</code> variable should contain the name of all your <code></code>.c files. These files will be compiled and linked to the final binary </li>
<li>the <code>RFLPC_DIR</code> is the relative path from your folder to the folder that contains the <code>rflpc-config</code> file </li>
<li>the <code>include</code> line includes the makefile that does all the magic for you. It contains generic rules for compiling your source files as well as the link rules to generate the <code></code>.elf and <code></code>.bin files</li>
</ul>
<p>Thus, you should just have to modify <code>OUTPUT_NAME</code> and <code>SRC</code> variables to create the needed makefile to compile your project.</p>
<p>To compile, just type <code>make</code>. You should see something like that</p>
<div class="fragment"><pre class="fragment"> $ makefile
 arm-none-eabi-gcc -mthumb -mcpu=cortex-m3 -fno-builtin -ffreestanding -Wall -Winline -O1 -I/home/hauspie/work/git/rflpc -DRFLPC_CONFIG_PLATFORM_MBED -include /home/hauspie/work/git/rflpc/rflpc17xx/config/config.h   -c -o main.o main.c
 arm-none-eabi-gcc -o modify_this.elf main.o -nostdlib -L/home/hauspie/work/git/rflpc/rflpc17xx -Wl,-T,rflpc17xx.ld,-Map=rflpc.map -lrflpc17xx 
 arm-none-eabi-objcopy -O binary -j .text -j .data modify_this.elf modify_this.bin 
</pre></div><p>If so, then you will have two files, an elf file and a bin file. The elf file is your program in ELF format. You can inspect it, dissassemble it... with commands such as your arm objdump. The bin file is the raw code memory file which is an extract of the <code></code>.text and <code></code>.data section of your elf file. For the MBED platform, it is this file that you have to copy on the USB mass storage drive.</p>
<p>To program your code on the MBED, you can issue a <code>make program</code>. This command will try to guess the mountpoint of your MBED (using the output of the <code>mount</code> command) and copy the bin file to it. After that, you just have to reset the MBED to actually flash the code.</p>
<h2><a class="anchor" id="config"></a>
Fine tuning the library</h2>
<p>The library can be configured so that some features are not included. This can save loads of code memory when you just need a few drivers. </p>
<h3><a class="anchor" id="config-file"></a>
Automatic generation of the configuration file</h3>
<p>The configuration file is located in the rflpc17xx/config folder. When you clone the git repository, this file is NOT included. However, if you just use <code>make</code> in the library folder, a default full configuration file is generated</p>
<p>This file is a C header file defining the needed MACRO to activate some functionalities To generate the file, you can use the makefile in the config folder. There are two main rules for generating a config file</p>
<ul>
<li><code>make empty_config</code></li>
<li><code>make full_config</code></li>
</ul>
<p>The first one generates an empty config file. Then, when the library is compiled it is compiled with the minimum features which are:</p>
<ul>
<li>board initialization code<ul>
<li>clock configuration</li>
<li>bss and data segment initialization</li>
<li>default interrupt setup</li>
</ul>
</li>
<li>interrupt management</li>
<li>Pins configuration</li>
<li>GPIOs</li>
<li>LEDs</li>
</ul>
<p>Pins configuration, GPIOs and LEDs are only macros or inlines in the library. Thus, the produced code will only include it if you use it. The library in the minimal configuration is about 800 bytes of code.</p>
<p>The second option (full_config) automatically extracts all the <code>RFLPC_CONFIG_ENABLE_xxx</code> macros from the library source code and add it to the config file. Thus, all the functionalities of the library are included. At the moment, this produce a library that is about 8kB of code.</p>
<h3><a class="anchor" id="fine-tune"></a>
Fine tuning the configuration file</h3>
<p>The simplest way to fine tune the library is to start by a make full_config and then remove the line you do not want from the <a class="el" href="config-options_8h_source.html">rflpc17xx/config/config-options.h</a> file You can either remove the lines completely or comment them</p>
<h3><a class="anchor" id="warnings"></a>
Common configuration mistakes</h3>
<p>When fine tuning the configuration be sure to:</p>
<ul>
<li>Recompile the library AND your program after making a change to the config file. (use make mrproper to clean the library and rebuild it)</li>
<li>Pay attention to dependencies. For example, if you enable printf but not UARTs, the default function used by printf to output its characters will do nothing</li>
<li>Most of the samples will not work if you do not enable at least uarts and printf </li>
</ul>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Wed May 16 2012 14:27:00 for rfLPC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.0 </li>
   </ul>
 </div>


</body>
</html>
